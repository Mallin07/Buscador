<head>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Poppins', sans-serif;
        padding: 20px;
        background: url('https://st4.depositphotos.com/2974663/27781/i/450/depositphotos_277817692-stock-photo-wooden-board-plank-texture-background.jpg');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        min-height: 100vh;
        margin: 0;
      }
  
      h1, h2 {
        text-align: center;
        color: #fff;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
      }
  
      .hidden { display: none; }
  
      .menu-button, .volver-button {
        display: block;
        margin: 20px auto;
        padding: 15px;
        width: 260px;
        font-size: 18px;
        background: rgba(0,0,0,0.7);
        color: white;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        transition: background 0.3s;
      }
      .menu-button:hover, .volver-button:hover {
        background: rgba(0,0,0,0.9);
      }
  
      .song-card {
        position: relative;
        margin: 15px 0;
        padding: 0;
        border-radius: 20px;
        overflow: hidden;
        background: rgba(0,0,0,0.5);
        box-shadow: 0 8px 16px rgba(0,0,0,0.5);
        backdrop-filter: blur(5px);
        transition: transform 0.3s, box-shadow 0.3s, opacity 1s;
        opacity: 0;
        animation: fadeIn 1s forwards;
      }
      .song-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 24px rgba(0,0,0,0.7);
      }
  
      .song-card h3, .song-card p, .song-card a {
        color: white;
        text-shadow: 2px 2px 5px rgba(0,0,0,0.8);
        margin: 5px 0;
      }
  
      .song-card button {
        background-color: #4b79a1;
        color: white;
        border: none;
        padding: 8px 12px;
        margin-top: 10px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.3s;
      }
      .song-card button:hover {
        background-color: #3a5d7e;
      }
  
      .search-bar select, .search-bar button {
        width: 200px;
        margin: 5px;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid #ccc;
        background: rgba(255,255,255,0.8);
      }
  
      form input, form select, form button, form label {
        display: block;
        width: 100%;
        margin-bottom: 10px;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid #ccc;
        background: rgba(255,255,255,0.9);
      }
  
      .checkbox-group {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  background: rgba(255,255,255,0.8);
  border: 1px solid #ccc;
  padding: 10px;
  margin-top: 10px;
  border-radius: 10px;
  justify-content: center; /* Centrar elementos */
}

/* üé® Cada g√©nero m√°s compacto */
.checkbox-group label {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  padding: 5px 10px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.3s;
  font-weight: 500;
  min-width: 150px; /* üéØ tama√±o m√≠nimo del cuadro */
  max-width: 180px; /* üéØ tama√±o m√°ximo */
  flex: 1 1 auto;
}

.checkbox-group label:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.checkbox-group input[type="checkbox"] {
  margin-left: 10px;
  transform: scale(1.2);
}
  
      @keyframes fadeIn {
        to { opacity: 1; }
      }
    </style>
  </head>
  
  <body>
  
    <!-- Pantalla de Inicio -->
    <div id="pantalla-inicio">
      <h1>üé∂ Bienvenido al Buscador de Partituras üé∂</h1>
      <button class="menu-button" onclick="mostrarBusqueda()">üîç Buscar Canciones</button>
      <button class="menu-button" onclick="mostrarAgregar()">‚ûï Agregar Nueva Canci√≥n</button>
      <button class="menu-button" onclick="iniciarSesion()">üîê Iniciar Sesi√≥n</button> <!-- NUEVO -->
      <button id="cerrar-sesion" class="menu-button hidden" onclick="cerrarSesion()">üö™ Cerrar Sesi√≥n</button> <!-- NUEVO -->
    </div>
  
    <!-- Pantalla de B√∫squeda -->
    <div id="pantalla-buscar" class="hidden">
      <button class="volver-button" onclick="volverInicio()">‚¨Ö Volver al Inicio</button>
      <h2>üîç Buscar y Filtrar Canciones</h2>
      <div class="search-bar">
        <select id="filtro-dificultad" onchange="filtrarCanciones()">
          <option value="">Filtrar por Dificultad</option>
          <option value="Rookie">Rookie</option>
          <option value="D">D</option>
          <option value="C">C</option>
          <option value="B">B</option>
          <option value="A">A</option>
        </select>
        <select id="filtro-instrumento" onchange="filtrarCanciones()">
          <option value="">Filtrar por Instrumento</option>
          <option value="Canto">Canto</option>
          <option value="Piano">Piano</option>
          <option value="Guitarra">Guitarra</option>
        </select>
        <select id="filtro-genero" onchange="filtrarCanciones()">
          <option value="">Filtrar por G√©nero</option>
          <option value="Blues">Blues</option>
          <option value="Cl√°sico">Cl√°sico</option>
          <option value="Country">Country</option>
          <option value="Flamenco">Flamenco</option>
          <option value="Funk">Funk</option>
          <option value="Hip-Hop">Hip-Hop</option>
          <option value="Jazz">Jazz</option>
          <option value="Latin">Latin</option>
          <option value="Pop">Pop</option>
          <option value="Punk">Punk</option>
          <option value="R&B">R&B</option>
          <option value="Reggae">Reggae</option>
          <option value="Rock">Rock</option>
          <option value="Rumba">Rumba</option>
          <option value="Soul">Soul</option>
          <option value="Tradicional">Tradicional</option>
          <option value="Urbano">Urbano</option>
        </select>
        <button type="button" onclick="limpiarFiltros()">Limpiar Filtros</button>
      </div>
      <div id="song-list"></div>
    </div>
  
    <!-- Pantalla de Agregar Nueva Canci√≥n -->
<div id="pantalla-agregar" class="hidden">
  <button class="volver-button" onclick="volverInicio()">‚¨Ö Volver al Inicio</button>
  <h2>‚ûï Agregar Nueva Canci√≥n</h2>
  <form id="add-song-form">
    <input type="text" id="artista" placeholder="Artista" required>
    <input type="text" id="nombre" placeholder="Nombre de la canci√≥n" required>

    <label>G√©nero musical:</label>
<button type="button" onclick="mostrarOcultarGeneros()">Seleccionar G√©neros</button>
<div class="checkbox-container hidden" id="genero">
  <div class="checkbox-group">
    <label>Blues <input type="checkbox" value="Blues"></label>
    <label>Cl√°sico <input type="checkbox" value="Cl√°sico"></label>
    <label>Country <input type="checkbox" value="Country"></label>
    <label>Flamenco <input type="checkbox" value="Flamenco"></label>
    <label>Funk <input type="checkbox" value="Funk"></label>
    <label>Hip-Hop <input type="checkbox" value="Hip-Hop"></label>
    <label>Jazz <input type="checkbox" value="Jazz"></label>
    <label>Latin <input type="checkbox" value="Latin"></label>
    <label>Pop <input type="checkbox" value="Pop"></label>
    <label>Punk <input type="checkbox" value="Punk"></label>
    <label>R&B <input type="checkbox" value="R&B"></label>
    <label>Reggae <input type="checkbox" value="Reggae"></label>
    <label>Rock <input type="checkbox" value="Rock"></label>
    <label>Rumba <input type="checkbox" value="Rumba"></label>
    <label>Soul <input type="checkbox" value="Soul"></label>
    <label>Tradicional <input type="checkbox" value="Tradicional"></label>
    <label>Urbano <input type="checkbox" value="Urbano"></label>
  </div>
  <button type="button" onclick="cerrarGeneros()">Confirmar selecci√≥n</button>
</div>
<div id="genero-seleccionado"></div>

    <label for="dificultad">Dificultad:</label>
    <select id="dificultad" required>
      <option value="">Seleccione dificultad</option>
      <option value="Rookie">Rookie</option>
      <option value="D">D</option>
      <option value="C">C</option>
      <option value="B">B</option>
      <option value="A">A</option>
    </select>

    <label for="instrumento">Instrumento:</label>
    <select id="instrumento" onchange="mostrarCamposCanto()">
      <option value="">Seleccione un instrumento</option>
      <option value="Canto">Canto</option>
      <option value="Piano">Piano</option>
      <option value="Guitarra">Guitarra</option>
    </select>

    <div id="campos-canto" class="hidden">
      <input type="text" id="registro" placeholder="Registro vocal">
      <input type="text" id="notaMin" placeholder="Nota m√°s baja">
      <input type="text" id="notaMax" placeholder="Nota m√°s alta">
      <label for="idioma">Idioma:</label>
      <select id="idioma">
        <option value="">Seleccione idioma</option>
        <option value="Alem√°n">Alem√°n</option>
        <option value="Catal√°n">Catal√°n</option>
        <option value="Espa√±ol">Espa√±ol</option>
        <option value="Franc√©s">Franc√©s</option>
        <option value="Ingl√©s">Ingl√©s</option>
        <option value="Italiano">Italiano</option>
        <option value="Portugu√©s">Portugu√©s</option>
      </select>
    </div>

    <input type="url" id="urlImagen" placeholder="URL de imagen (opcional)">
    <input type="url" id="urlPartitura" placeholder="URL de la partitura (opcional)">
    <input type="url" id="urlAcordes" placeholder="URL de acordes (opcional)">
    <input type="url" id="urlYouTube" placeholder="URL de video YouTube (opcional)">

    <!-- üîµ NUEVO: Mensaje de carga mientras se comprime imagen -->
    <div id="loading-message" class="hidden" style="text-align:center; color:white; margin-bottom: 15px;">
      üõ†Ô∏è Comprimiendo imagen... Por favor espera.
    </div>

    <button type="submit" id="submit-button">Guardar Canci√≥n</button>
  </form>
</div>


<!-- üîµ Cargar Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<!-- üîµ Inicializar Firebase -->
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBA3e5tiOZQzSyBEdBlZok2vA2akbybCQk",
  authDomain: "buscadordepartituras.firebaseapp.com",
  projectId: "buscadordepartituras",
  storageBucket: "buscadordepartituras.appspot.com",
  messagingSenderId: "184465190778",
  appId: "1:184465190778:web:b30c9c66d5fdc43d38b0c3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();
</script>

<!-- üîµ Script Principal -->
<script>
  let canciones = [];
  let editandoCancionIndex = null;
  let usuarioAutenticado = false;
  
  // üîµ Detectar sesi√≥n activa
  firebase.auth().onAuthStateChanged(user => {
    usuarioAutenticado = !!user;
    document.getElementById('cerrar-sesion').classList.toggle('hidden', !usuarioAutenticado);
    const botonesAgregar = document.querySelectorAll('.menu-button');
    botonesAgregar.forEach(btn => {
      if (btn.textContent.includes('Agregar Nueva Canci√≥n')) {
        btn.classList.toggle('hidden', !usuarioAutenticado);
      }
    });
    cargarCanciones();
  });
  
  // üîµ Funciones de sesi√≥n
  function iniciarSesion() {
    const email = prompt('Introduce tu correo:');
    const password = prompt('Introduce tu contrase√±a:');
    firebase.auth().signInWithEmailAndPassword(email, password)
      .then(() => alert('¬°Sesi√≥n iniciada exitosamente!'))
      .catch(error => alert('Error al iniciar sesi√≥n: ' + error.message));
  }
  
  function cerrarSesion() {
    firebase.auth().signOut()
      .then(() => alert('Sesi√≥n cerrada.'))
      .catch(error => alert('Error al cerrar sesi√≥n: ' + error.message));
  }
  
  // üîµ Navegaci√≥n
  function mostrarBusqueda() {
    if (!usuarioAutenticado) {
      alert('Debes iniciar sesi√≥n para buscar canciones.');
      return;
    }
    document.getElementById('pantalla-inicio').classList.add('hidden');
    document.getElementById('pantalla-agregar').classList.add('hidden');
    document.getElementById('pantalla-buscar').classList.remove('hidden');
  }
  
  function mostrarAgregar() {
    if (!usuarioAutenticado) {
      alert('Debes iniciar sesi√≥n para agregar canciones.');
      return;
    }
    document.getElementById('pantalla-inicio').classList.add('hidden');
    document.getElementById('pantalla-buscar').classList.add('hidden');
    document.getElementById('pantalla-agregar').classList.remove('hidden');
  }
  
  function volverInicio() {
    document.getElementById('pantalla-buscar').classList.add('hidden');
    document.getElementById('pantalla-agregar').classList.add('hidden');
    document.getElementById('pantalla-inicio').classList.remove('hidden');
    editandoCancionIndex = null;
    document.getElementById('submit-button').textContent = 'Guardar Canci√≥n';
  }
  
  // üîµ Funciones auxiliares
  function mostrarCamposCanto() {
    const instrumento = document.getElementById('instrumento').value;
    const camposCanto = document.getElementById('campos-canto');
    if (instrumento === 'Canto') {
      camposCanto.classList.remove('hidden');
    } else {
      camposCanto.classList.add('hidden');
      ['registro', 'notaMin', 'notaMax', 'idioma'].forEach(id => {
        document.getElementById(id).value = '';
      });
    }
  }
  
  function mostrarOcultarGeneros() {
    document.getElementById('genero').classList.toggle('hidden');
  }
  
  function cerrarGeneros() {
    const checkboxes = document.querySelectorAll('#genero input[type=checkbox]');
    const seleccionados = Array.from(checkboxes).filter(cb => cb.checked).map(cb => cb.value);
    document.getElementById('genero-seleccionado').innerText = seleccionados.length
      ? 'Seleccionado: ' + seleccionados.join(', ')
      : 'No hay g√©neros seleccionados';
    document.getElementById('genero').classList.add('hidden');
  }
  
  // üîµ Mostrar canciones
  function crearSongCard(song, index) {
    const div = document.createElement('div');
    div.className = 'song-card';
  
    if (song.urlImagen) {
      div.style.backgroundImage = `url('${song.urlImagen}')`;
      div.style.backgroundSize = 'cover';
      div.style.backgroundPosition = 'center';
    }
  
    const content = document.createElement('div');
    content.className = 'content';
    content.innerHTML = `
      <h3>${song.artista} - ${song.nombre}</h3>
      <p><strong>G√©neros:</strong> ${Array.isArray(song.genero) ? song.genero.join(', ') : 'N/A'}</p>
      <p><strong>Dificultad:</strong> ${song.dificultad}</p>
      <p><strong>Instrumento:</strong> ${song.instrumento || 'N/A'}</p>
      ${song.instrumento === 'Canto' ? `
        <p><strong>Registro vocal:</strong> ${song.registro}</p>
        <p><strong>Nota m√°s baja:</strong> ${song.notaMin}</p>
        <p><strong>Nota m√°s alta:</strong> ${song.notaMax}</p>
        <p><strong>Idioma:</strong> ${song.idioma}</p>` : ''}
      ${song.urlPartitura ? `<p><a href="${song.urlPartitura}" target="_blank" style="color:#ffd700;">üìÑ Ver Partitura</a></p>` : ''}
      ${song.urlAcordes ? `<p><a href="${song.urlAcordes}" target="_blank" style="color:#90ee90;">üé∏ Ver Acordes</a></p>` : ''}
      ${song.urlYouTube ? `<p><a href="${song.urlYouTube}" target="_blank" style="color:#ffd700;">üé• Ver Video</a></p>` : ''}
      ${usuarioAutenticado ? `
        <button onclick="editarCancion(${index})">‚úèÔ∏è Editar</button>
        <button onclick="eliminarCancion(${index})">üóëÔ∏è Eliminar</button>
      ` : ''}
    `;
    div.appendChild(content);
    return div;
  }
  
  function cargarCanciones() {
    db.collection('canciones').orderBy('artista').get()
      .then(querySnapshot => {
        canciones = [];
        querySnapshot.forEach(doc => {
          canciones.push({ id: doc.id, ...doc.data() });
        });
        mostrarCanciones();
      });
  }
  
  function mostrarCanciones(lista = canciones) {
    const songList = document.getElementById('song-list');
    songList.innerHTML = '';
  
    lista.sort((a, b) => a.artista.toLowerCase().localeCompare(b.artista.toLowerCase()));
  
    lista.forEach((song, index) => {
      const songCard = crearSongCard(song, index);
      songList.appendChild(songCard);
    });
  }
  
  function filtrarCanciones() {
    const dificultad = document.getElementById('filtro-dificultad').value;
    const instrumento = document.getElementById('filtro-instrumento').value;
    const genero = document.getElementById('filtro-genero') ? document.getElementById('filtro-genero').value : '';
  
    const filtradas = canciones.filter(song => {
      const generoIncluido = genero === '' || (Array.isArray(song.genero) && song.genero.includes(genero));
      return (dificultad === '' || song.dificultad === dificultad) &&
             (instrumento === '' || song.instrumento === instrumento) &&
             generoIncluido;
    });
  
    mostrarCanciones(filtradas);
  }
  
  function limpiarFiltros() {
    document.getElementById('filtro-dificultad').value = '';
    document.getElementById('filtro-instrumento').value = '';
    if (document.getElementById('filtro-genero')) {
      document.getElementById('filtro-genero').value = '';
    }
    mostrarCanciones(canciones);
  }
  
  // üîµ Guardar y eliminar canciones
  document.getElementById('add-song-form').addEventListener('submit', function(event) {
    event.preventDefault();
  
    const artista = document.getElementById('artista').value;
    const nombre = document.getElementById('nombre').value;
    const genero = Array.from(document.querySelectorAll('#genero input[type=checkbox]'))
      .filter(cb => cb.checked).map(cb => cb.value);
    const dificultad = document.getElementById('dificultad').value;
    const instrumento = document.getElementById('instrumento').value;
    const registro = document.getElementById('registro').value;
    const notaMin = document.getElementById('notaMin').value;
    const notaMax = document.getElementById('notaMax').value;
    const idioma = document.getElementById('idioma').value;
    const urlPartitura = document.getElementById('urlPartitura').value;
    const urlAcordes = document.getElementById('urlAcordes').value;
    const urlYouTube = document.getElementById('urlYouTube').value;
    const urlImagen = document.getElementById('urlImagen').value.trim();
  
    const nuevaCancionBase = {
      artista, nombre, genero, dificultad, instrumento,
      registro: instrumento === 'Canto' ? registro : '',
      notaMin: instrumento === 'Canto' ? notaMin : '',
      notaMax: instrumento === 'Canto' ? notaMax : '',
      idioma: instrumento === 'Canto' ? idioma : '',
      urlPartitura, urlAcordes, urlYouTube, urlImagen
    };
  
    guardarCancion(nuevaCancionBase);
  });
  
  function guardarCancion(newSong) {
    guardarEnFirestore(newSong);
  }
  
  function guardarEnFirestore(newSong) {
    if (editandoCancionIndex !== null) {
      const songId = canciones[editandoCancionIndex].id;
      db.collection('canciones').doc(songId).set(newSong)
        .then(() => {
          alert('‚úÖ Canci√≥n actualizada correctamente.');
          cargarCanciones();
          volverInicio();
        })
        .catch(error => {
          console.error('‚ùå Error al actualizar canci√≥n:', error);
          alert('‚ö†Ô∏è No tienes permisos para editar esta canci√≥n.');
        });
      editandoCancionIndex = null;
      document.getElementById('submit-button').textContent = 'Guardar Canci√≥n';
    } else {
      db.collection('canciones').add(newSong)
        .then(() => {
          alert('‚úÖ Nueva canci√≥n guardada.');
          cargarCanciones();
          volverInicio();
        })
        .catch(error => {
          console.error('‚ùå Error al guardar nueva canci√≥n:', error);
          alert('‚ö†Ô∏è Error al guardar la canci√≥n.');
        });
    }
  }
  
  function editarCancion(index) {
    const song = canciones[index];
    document.getElementById('artista').value = song.artista || '';
    document.getElementById('nombre').value = song.nombre || '';
  
    const checkboxes = document.querySelectorAll('#genero input[type=checkbox]');
    checkboxes.forEach(cb => {
      cb.checked = Array.isArray(song.genero) && song.genero.includes(cb.value);
    });
    cerrarGeneros();
  
    document.getElementById('dificultad').value = song.dificultad || '';
    document.getElementById('instrumento').value = song.instrumento || '';
    mostrarCamposCanto();
  
    if (song.instrumento === 'Canto') {
      document.getElementById('registro').value = song.registro || '';
      document.getElementById('notaMin').value = song.notaMin || '';
      document.getElementById('notaMax').value = song.notaMax || '';
      document.getElementById('idioma').value = song.idioma || '';
    }
  
    document.getElementById('urlPartitura').value = song.urlPartitura || '';
    document.getElementById('urlAcordes').value = song.urlAcordes || '';
    document.getElementById('urlYouTube').value = song.urlYouTube || '';
    document.getElementById('urlImagen').value = song.urlImagen || '';
  
    editandoCancionIndex = index;
    document.getElementById('submit-button').textContent = 'Actualizar Canci√≥n';
    mostrarAgregar();
  }
  
  function eliminarCancion(index) {
    if (confirm('¬øSeguro que quieres eliminar esta canci√≥n?')) {
      const songId = canciones[index].id;
      db.collection('canciones').doc(songId).delete()
        .then(() => {
          alert('üóëÔ∏è Canci√≥n eliminada.');
          cargarCanciones();
        })
        .catch(error => {
          console.error('‚ùå Error al eliminar canci√≥n:', error);
          alert('‚ö†Ô∏è No tienes permisos para eliminar esta canci√≥n.');
        });
    }
  }
  
  // üî• Al iniciar
  cargarCanciones();
  </script>
  
  



</body>
</html>